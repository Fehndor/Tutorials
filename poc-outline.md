# Automated Oracle DBA Tasks PoC with Ansible & Jira Integration

**Goal:** Build a safe, professional proof-of-concept (PoC) that automates Oracle tasks using Ansible and reports results to Jira, all running in local VMs. This guide is step-by-step, practical, and designed for dev/test environments only.

---

## Table of Contents

1. [Overview & Goals](#overview--goals)
2. [Hardware & Software Prerequisites](#hardware--software-prerequisites)
3. [Top-Level Architecture](#top-level-architecture)
4. [Detailed Implementation Steps](#detailed-implementation-steps)
5. [Testing & Verification Plan](#testing--verification-plan)
6. [CI / Scheduling / Logging / Monitoring](#ci--scheduling--logging--monitoring)
7. [Security, Rollback, and Governance](#security-rollback-and-governance)
8. [Deliverables, Timeline & Milestones](#deliverables-timeline--milestones)
9. [Example Manager Pitch & Acceptance Criteria](#example-manager-pitch--acceptance-criteria)
10. [Extras: Useful Snippets and Tips](#extras-useful-snippets-and-tips)
11. [Final Advice](#final-advice)

---

## 1. Overview & Goals

**Primary Goal:**  
Build a non-prod PoC that uses Ansible to perform common Oracle DBA tasks (read-only checks, safe write ops in dev only), and automatically creates/updates a Jira ticket with the result.

**Capabilities:**

- Provision 3 VMs locally:  
  - Ansible controller (also runs Jira)  
  - Oracle XE DB VM  
  - Optional target VM (for multi-DB tests)
- Ansible playbooks to:
  - Connect to Oracle XE and run read-only health checks (version, uptime, tablespace usage)
  - Optionally create a sandbox schema/user (dev only)
  - Optionally trigger a backup of a test schema (dev data)
- Report results to Jira via REST API
- Demonstrable logs, idempotent playbooks, and documentation

**Why:**  
Showcase automation, Oracle knowledge, and cross-tool integration—all without touching production.

---

## 2. Hardware & Software Prerequisites

**Minimum Recommended Hardware:**

- 16 GB RAM (24 GB preferred)
- 4+ CPU cores
- 100+ GB free disk
- Virtualization enabled in BIOS

**Software Stack:**

- VirtualBox or VMware Workstation Player
- Vagrant (optional)
- Linux images: Ubuntu 22.04 LTS or Rocky/Alma/Oracle Linux 8
- Ansible (>=2.13 recommended)
- Python, pip, cx_Oracle
- Oracle Database XE (21c XE recommended)
- Jira: Atlassian Cloud (free trial) or Jira Server (VM)
- Git, GitHub/GitLab

**Notes:**

- If hardware-limited, use 2 VMs and host Jira in the cloud.
- Use VM snapshots for rollback.

---

## 3. Top-Level Architecture

```
[Your Laptop/Host]
   └─ VirtualBox VMs:
       ├─ controller VM (Ansible + Jira; git repo)
       ├─ oracle-dev VM (Oracle XE)
       └─ optional oracle-test VM
```

- VMs on a single NAT/host-only network for SSH connectivity.
- Data flow:  
  Developer triggers Ansible → connects to Oracle → gathers results → posts to Jira.

---

## 4. Detailed Implementation Steps

### Phase 0 — Prep: Provision VMs

1. Install VirtualBox and (optionally) Vagrant.
2. Create controller VM (Ubuntu 22.04): 4 CPU, 6–8 GB RAM, 40 GB disk.
3. Create oracle-dev VM (Oracle Linux 8 or Ubuntu): 4 CPU, 6–8 GB RAM, 80+ GB disk.

### Phase 1 — Controller VM Setup

1. SSH into controller VM.
2. Install required packages:
   ```bash
   sudo apt update && sudo apt install -y git python3 python3-pip ansible virtualenv jq
   pip3 install --user cx_Oracle
   ```
3. Configure SSH keys:
   ```bash
   ssh-keygen -t ed25519 -f ~/.ssh/id_ansible -N ""
   ssh-copy-id -i ~/.ssh/id_ansible.pub user@oracle-dev-ip
   ```
4. Create project repo:
   ```bash
   mkdir ~/ansible-oracle-jira && cd ~/ansible-oracle-jira
   git init
   ```
5. Install Ansible collections:
   ```bash
   ansible-galaxy collection install community.general
   ```
6. Create `ansible.cfg`:
   ```ini
   [defaults]
   inventory = inventory/hosts.ini
   host_key_checking = False
   retry_files_enabled = False
   ```
7. Inventory file `inventory/hosts.ini`:
   ```ini
   [dev-db]
   oracle-dev ansible_host=192.168.56.101 ansible_user=youruser ansible_ssh_private_key_file=~/.ssh/id_ansible
   ```

### Phase 2 — Oracle XE VM Setup

1. Install Oracle XE (follow Oracle docs).
2. Ensure listener is configured and DB is accessible:
   ```sql
   sqlplus system/YourSysPass@localhost/XEPDB1
   SELECT version FROM v$instance;
   ```
3. Create dev schema and test table:
   ```sql
   CREATE USER poc_dev IDENTIFIED BY pocpass;
   GRANT CONNECT, RESOURCE TO poc_dev;
   CREATE TABLE poc_dev.test (id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY, value VARCHAR2(100));
   INSERT INTO poc_dev.test (value) VALUES ('hello');
   COMMIT;
   ```

### Phase 3 — Ansible Playbooks

**Directory Structure:**
```
playbooks/
  check_oracle.yml
  create_schema.yml
roles/
  oracle/
    tasks/
      check.yml
      create_schema.yml
group_vars/
  all.yml
vars/
  vault.yml (encrypted)
```

**Example `playbooks/check_oracle.yml`:**
```yaml
---
- name: Oracle health checks and report
  hosts: dev-db
  gather_facts: no
  vars_files:
    - ../vars/vault.yml
  tasks:
    - name: Check Oracle version via sqlplus
      shell: |
        echo "SET HEADING OFF;
        SELECT version FROM v$instance;" | sqlplus -s system/{{ oracle_sys_pass }}@localhost/XEPDB1
      register: oracle_version
      changed_when: false

    - name: Get tablespace usage
      shell: |
        echo "SET PAGESIZE 0 FEEDBACK OFF VERIFY OFF HEADING OFF ECHO OFF
        SELECT tablespace_name||','||ROUND(SUM(bytes)/1024/1024,2) FROM dba_data_files GROUP BY tablespace_name;" | sqlplus -s system/{{ oracle_sys_pass }}@localhost/XEPDB1
      register: tbs
      changed_when: false

    - name: Build JSON report
      set_fact:
        oracle_report: "{{ {'version': oracle_version.stdout | trim, 'tablespaces': tbs.stdout_lines} }}"

    - name: Save report to local file (on controller)
      local_action:
        module: copy
        content: "{{ oracle_report | to_nice_json }}"
        dest: "./reports/oracle_report_{{ inventory_hostname }}.json"

    - name: Post report to Jira
      delegate_to: localhost
      uri:
        url: "https://your-jira-instance/rest/api/2/issue"
        method: POST
        user: "{{ jira_user }}"
        password: "{{ jira_api_token }}"
        force_basic_auth: yes
        headers:
          Content-Type: "application/json"
        body_format: json
        body:
          fields:
            project:
              key: "POC"
            summary: "Oracle dev DB check - {{ inventory_hostname }} - {{ lookup('pipe','date +%Y-%m-%d_%H:%M') }}"
            issuetype:
              name: "Task"
            description: |
              Oracle Version: {{ oracle_report.version }}
              Tablespaces:
              {% for line in oracle_report.tablespaces %}
                - {{ line }}
              {% endfor %}
      status_code: 201
      register: jira_create
      when: jira_enabled | default(true)
```

**Vault Example (`vars/vault.yml`):**
```yaml
oracle_sys_pass: "SysPasswordHere"
jira_user: "jira-user@example.com"
jira_api_token: "JIRA_TOKEN"
```
Encrypt with:
```bash
ansible-vault encrypt vars/vault.yml
```

### Phase 4 — Jira Setup

- Use Atlassian Cloud trial or install Jira Server in a VM.
- Obtain a Jira project key (e.g., `POC`) and API token.
- Test API manually:
  ```bash
  curl -u 'user:API_TOKEN' -X POST --data '{"fields":{"project":{"key":"POC"},"summary":"test","issuetype":{"name":"Task"}}}' -H "Content-Type: application/json" https://your-jira/rest/api/2/issue
  ```

### Phase 5 — Create Schema Playbook

**Example (`playbooks/create_schema.yml`):**
```yaml
- name: Create dev schema
  hosts: dev-db
  vars_files:
    - ../vars/vault.yml
  pre_tasks:
    - name: Ensure host is labeled dev
      assert:
        that:
          - "'dev' in inventory_hostname or 'dev' in group_names"
        fail_msg: "This playbook must only run against dev hosts!"
  tasks:
    - name: Create POC schema
      shell: |
        echo "CREATE USER poc_dev IDENTIFIED BY pocpass; GRANT CONNECT, RESOURCE TO poc_dev;" | sqlplus -s system/{{ oracle_sys_pass }}@localhost/XEPDB1
      register: create_user
      changed_when: "'created' in create_user.stdout or create_user.rc == 0"
```

### Phase 6 — Backup (Dev)

**Example:**
```yaml
- name: Dump small table to CSV
  hosts: dev-db
  tasks:
    - name: Export test table to CSV
      shell: |
        echo "SET HEADING OFF FEEDBACK OFF PAGESIZE 0; SPOOL /tmp/poc_test.csv; SELECT id||','||value FROM poc_dev.test; SPOOL OFF;" | sqlplus -s poc_dev/pocpass@localhost/XEPDB1
      register: dump
```

### Phase 7 — Jira Integration Improvements

- Add comments to existing Jira issues:
  ```yaml
  - name: Add comment to POC issue
    uri:
      url: "https://your-jira/rest/api/2/issue/POC-123/comment"
      method: POST
      user: "{{ jira_user }}"
      password: "{{ jira_api_token }}"
      headers:
        Content-Type: "application/json"
      body_format: json
      body:
        body: |
          Oracle check ran on {{ inventory_hostname }}:
          Version: {{ oracle_report.version }}
          Tablespaces:
          {% for line in oracle_report.tablespaces %}
            - {{ line }}
          {% endfor %}
  ```

### Phase 8 — Driver Script & Scheduling

**Example `run_poc.sh`:**
```bash
#!/bin/bash
ansible-playbook playbooks/check_oracle.yml --ask-vault-pass
# move artifacts to a folder, zip them, or call another script
```
- Test manually, then add a cronjob or systemd timer for scheduled checks.

---

## 5. Testing & Verification Plan

1. **Unit test each step:**
   - Test SSH with `ansible -m ping dev-db`
   - Test `sqlplus` manually
   - Test Jira API with `curl`
2. **Run playbooks with `--check` where possible.**
3. **Check idempotency:**  
   Run playbook twice; second run should show minimal/no changes.
4. **Simulate failure:**  
   Use bad credentials to ensure clean failure and Jira notification.
5. **Document test cases:**  
   Success, network failure, credential failure, permission denied.

**Verification:**

- Check `reports/oracle_report_*.json`
- Validate Jira issue created/updated

---

## 6. CI / Scheduling / Logging / Monitoring

- Use local Git repo; commit playbooks.
- Set up GitHub Actions/GitLab CI (requires runner).
- Save all `ansible-playbook` output to timestamped log files.
- Monitor via Jira issues; for production, integrate with Prometheus/ELK.

---

## 7. Security, Rollback, and Governance

- **Credentials:**  
  Use `ansible-vault` for secrets. Never commit plain YAML with secrets.
- **Access Control:**  
  Restrict SSH keys and DB accounts.
- **Change Management:**  
  For prod, follow formal change control.
- **Rollback:**  
  Write playbooks must have rollback actions. Always snapshot VMs before write ops.
- **Audit:**  
  Keep logs and attach to Jira for traceability.

---

## 8. Deliverables, Timeline & Milestones

**3-Week Timeline Example:**

- **Week 1:** Setup & Safe Read-Only PoC
- **Week 2:** Schema automation (dev) + backups
- **Week 3:** Polish, docs & manager demo

**Deliverables:**

- Git repo with playbooks/roles and encrypted vault file
- Demo run logs and Jira issue(s)
- One-page summary with next steps and risk analysis

---

## 9. Example Manager Pitch & Acceptance Criteria

**Email Template:**
> Subject: Proposal — Automating routine Oracle tasks (dev) with Ansible — 2-week PoC  
>
> Hi [Manager],  
>
> I’d like to run a safe, short PoC to automate some routine Oracle tasks in our dev environment using Ansible and to demonstrate automated reporting into Jira. The PoC will be fully isolated to non-prod VMs on my laptop, documented, and reversible.
>
> Benefits: faster, consistent dev environment setup; fewer manual errors; a reusable automation template we can extend to test/dev environments.
>
> Timeline: 2–3 weeks (proof, docs, demo). I’ll share results and next-step recommendations. No changes to production, and I’ll follow any policies you request.
>
> If you’re ok with that, I’ll start and show you the first demo next [date].
>
> Thanks — Sándor

**Acceptance Criteria:**

1. PoC is limited to dev VMs—no production access.
2. All credentials handled via Ansible Vault.
3. Demonstration includes: automated check run, Jira ticket/log, and revert steps.
4. Documented risks and next steps for safe rollout.

---

## 10. Extras: Useful Snippets and Tips

- **Ansible Vault:**
  ```bash
  ansible-vault create vars/vault.yml
  ansible-playbook playbooks/check_oracle.yml --ask-vault-pass
  ```
- **Jira curl to add a comment:**
  ```bash
  curl -D- -u "user:APITOKEN" -X POST --data '{"body":"Automated check success."}' -H "Content-Type: application/json" "https://your-jira/rest/api/2/issue/POC-1/comment"
  ```
- **Idempotency:**  
  For read-only checks, use `changed_when: false`.  
  For write tasks, check for existence before creating.
- **Logging Wrapper:**
  ```bash
  # run_poc.sh
  TIMESTAMP=$(date +%Y%m%d_%H%M)
  ansible-playbook playbooks/check_oracle.yml --vault-password-file ~/.vault_pass.txt | tee logs/run_${TIMESTAMP}.log
  ```

---

## 11. Final Advice

- **Start read-only.**  
  Do not touch write operations until you have repeatable success and manager buy-in.
- **Assert dev/test-only in playbooks.**
- **Document everything:**  
  Logs, screenshots, and Git commits are persuasive.
- **Think permission-first:**  
  Get explicit approval before moving to company servers.
- **This PoC is great CV material** if done cleanly.

---
